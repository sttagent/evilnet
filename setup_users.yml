---
- name: setup connection
  hosts: evilserver
  remote_user: "{{ main_user }}"
  become: true
  vars:
    ansible_ssh_args: "-o PreferredAuthentications=password"
    ansible_ssh_pass: "{{ main_user_password }}"
  
  tasks:
  - name: cpy evilroots ssh key
    authorized_key:
      user: "{{ main_user }}"
      state: present
      key: "{{ evilroots_ssh_pub_key }}"

  - name: cpy evilbook ssh key
    authorized_key:
      user: "{{ main_user }}"
      state: present
      key: "{{ evilbook_ssh_pub_key }}"

  - name: config sshd_config
    copy:
      content: |
        PermitRootLogin no
        PasswordAuthentication no
      dest: /etc/ssh/sshd_config.d/99-evilserver.conf
      owner: root
      group: root
      mode: '0600'
